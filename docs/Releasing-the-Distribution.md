# OpenSearch Release Process

This document explains the OpenSearch Release Process in detail.

## Preparation
### Release Terminology and Knowledge Center

#### Definitions

**OpenSearch Project**: OpenSearch is a community-driven, Apache 2.0-licensed open source search and analytics suite that makes it easy to ingest, search, visualize, and analyze data. </br>

**OpenSearch/OpenSearch Dashboards Bundle**: An OpenSearch/OpenSearch Dashboards bundle refers to a compressed file that encompasses both the OpenSearch/OpenSearch Dashboards distribution and accompanying plugins. This compressed file acts as a container for the OpenSearch/OpenSearch Dashboards software and its associated extensions, enabling users to conveniently package and deploy the entire system. </br>

**OpenSearch/OpenSearch Dashboards Components/Plugins**: OpenSearch/OpenSearch Dashboards components/plugins are extensions that can be added to OpenSearch/OpenSearch Dashboards, to add new features or functionality. There are a wide variety of plugins available refer [OpenSearch available plugins](https://opensearch.org/docs/latest/install-and-configure/plugins/#available-plugins) and [OpenSearch Dashboards available plugins](https://opensearch.org/docs/latest/install-and-configure/install-dashboards/plugins/#available-plugins) sections.</br>

#### Types of Manifests

##### Input Manifest

These manifests serve as the initial input for driving the build workflow. These manifests are located in [build repository](https://github.com/opensearch-project/opensearch-build/tree/main/manifests) and are generated by the [manifest workflow](https://github.com/opensearch-project/opensearch-build/tree/main/src/manifests_workflow). Once the manifest is created, the maintainers of the build repository review and merge it into the `main` branch. The entire build repository operates exclusively on the `main` branch.

##### Test Manifest

These manifests are integral to the comprehensive testing of the core and components/plugins, as they contain numerous settings and configurations that facilitate various tests within the [test_workflow](https://github.com/opensearch-project/opensearch-build/tree/main/src/test_workflow).

###### Sample Test Manifests

| OpenSearch | OpenSearch Dashboards | 
| --- | --- |
| [opensearch-2.8.0-test.yml](https://github.com/opensearch-project/opensearch-build/blob/opensearch-2.8.0/manifests/2.8.0/opensearch-2.8.0-test.yml) | [opensearch-dashboards-2.8.0-test.yml](https://github.com/opensearch-project/opensearch-build/blob/opensearch-2.8.0/manifests/2.8.0/opensearch-dashboards-2.8.0-test.yml)

##### Build Manifest

Output of the [build workflow](https://github.com/opensearch-project/opensearch-build/tree/main/src/build_workflow), used as input to the [assemble workflow](https://github.com/opensearch-project/opensearch-build/tree/main/src/assemble_workflow).

  ###### Sample Generated Build Manifests

  | deb | rpm | tar | windows |
  | --- | --- | --- | ------- |
  | [os-arm64](https://ci.opensearch.org/ci/dbc/distribution-build-opensearch/1.3.10/7848/linux/arm64/deb/builds/opensearch/manifest.yml), [os-x64](https://ci.opensearch.org/ci/dbc/distribution-build-opensearch/1.3.10/7848/linux/x64/deb/builds/opensearch/manifest.yml)    |  [os-arm64](https://ci.opensearch.org/ci/dbc/distribution-build-opensearch/1.3.10/7848/linux/arm64/rpm/builds/opensearch/manifest.yml), [os-x64](https://ci.opensearch.org/ci/dbc/distribution-build-opensearch/1.3.10/7848/linux/x64/rpm/builds/opensearch/manifest.yml)   |  [os-x64](https://ci.opensearch.org/ci/dbc/distribution-build-opensearch/1.3.10/7848/linux/x64/tar/builds/opensearch/manifest.yml), [os-arm64](https://ci.opensearch.org/ci/dbc/distribution-build-opensearch/1.3.10/7848/linux/arm64/tar/builds/opensearch/manifest.yml)   |    [os-x64](https://ci.opensearch.org/ci/dbc/distribution-build-opensearch/1.3.10/7848/windows/x64/zip/builds/opensearch/manifest.yml)     |


##### Bundle/Dist Manifest

The final output of the assemble workflow and manifest that is added to the final distribution, this has the commitID (can be used for reproducible builds) and the artifact file links. This final bundle manifest incorporates the assembled components and ensures traceability through the commit ID and accessibility to the artifact files.

  ###### Sample Generated Bundle Manifests

  | deb | rpm | tar | windows |
  | --- | --- | --- | ------- |
  | [os-arm64](https://ci.opensearch.org/ci/dbc/distribution-build-opensearch/1.3.10/7848/linux/arm64/deb/dist/opensearch/manifest.yml), [os-x64](https://ci.opensearch.org/ci/dbc/distribution-build-opensearch/1.3.10/7848/linux/x64/deb/dist/opensearch/manifest.yml)    |  [os-arm64](https://ci.opensearch.org/ci/dbc/distribution-build-opensearch/1.3.10/7848/linux/arm64/rpm/dist/opensearch/manifest.yml), [os-x64](https://ci.opensearch.org/ci/dbc/distribution-build-opensearch/1.3.10/7848/linux/x64/rpm/dist/opensearch/manifest.yml)   |  [os-x64](https://ci.opensearch.org/ci/dbc/distribution-build-opensearch/1.3.10/7848/linux/x64/tar/dist/opensearch/manifest.yml), [os-arm64](https://ci.opensearch.org/ci/dbc/distribution-build-opensearch/1.3.10/7848/linux/arm64/tar/dist/opensearch/manifest.yml)   |    [os-x64](https://ci.opensearch.org/ci/dbc/distribution-build-opensearch/1.3.10/7848/windows/x64/zip/dist/opensearch/manifest.yml)     |


#### AUTOCUT issues

These are the issues created by automation with the distribution build and integration-test workflows failure, the automation detects the component failure and raises an issue in the respective component repo. Sample [integ-test failure AUTOCUT issue](https://github.com/opensearch-project/k-NN/issues/914) and [distribution build failure AUTOCUT issue](https://github.com/opensearch-project/k-NN/issues/732). The created `AUTOCUT` issues will have the updated information with latest build failure details. The automation also detects if the component build has passed and closes the issues automatically. For more details refer the [updateBuildFailureIssues.groovy](https://github.com/opensearch-project/opensearch-build-libraries/blob/main/vars/updateBuildFailureIssues.groovy).


#### Build Workflows

| Workflow                                                                                                                      | Description         |
| ----------------------------------------------------------------------------------------------------------------------------- | ------------------- |
| [Check for Build](https://build.ci.opensearch.org/job/check-for-build/)                                                       | Workflow that periodically triggers the distribution workflows using parameterized cron. |
| [OpenSearch Distribution Build](https://build.ci.opensearch.org/job/distribution-build-opensearch/)                           | Workflow that is responsible to build the OpenSearch and its components as well as assemble it into a distribution.  |
| [OpenSearch Dashboards Distribution Build](https://build.ci.opensearch.org/job/distribution-build-opensearch-dashboards/)     | Workflow that is responsible to build the OpenSearch Dashboards and its components as well as assemble it into a distribution. |
| [OpenSearch Integ Test](https://build.ci.opensearch.org/job/integ-test/)                                                      | Workflow that runs integration tests for OpenSearch components.          |
| [OpenSearch Dashboards Integ Test](https://build.ci.opensearch.org/job/integ-test-opensearch-dashboards/)                     | Workflow that runs integration tests for OpenSearch Dashboards and its components. |
| [Benchmark Tests](https://build.ci.opensearch.org/job/benchmark-test/)                                                        | Workflow that runs Performance tests using [opensearch-benchmark](https://github.com/opensearch-project/opensearch-benchmark) on a cluster created with a given version.                |
| [BWC Tests](https://build.ci.opensearch.org/job/bwc-test/)                                                                    | Workflow that runs backward compatibility tests for OpenSearch Components on a cluster created with a given version. |
| [Docker Build](https://build.ci.opensearch.org/job/docker-build/)                                                             | Workflow that builds the OpenSearch and OpenSearch Dashboards docker images. |
| [Docker Copy](https://build.ci.opensearch.org/job/docker-copy/)                                                               | Workflow that copies the created docker images to multiple DockerHub and ECR repositories. |
| [Docker Scan](https://build.ci.opensearch.org/job/docker-scan/)                                                               | Workflow that checks vulnerabilities for a given docker image as an input. |
| [1.x Maven Publish](https://build.ci.opensearch.org/job/snapshot-maven-publish-1.x/)                                          | Workflow that publishes snapshots to [maven](https://aws.oss.sonatype.org/content/repositories/snapshots/org/opensearch/), used only for 1.3.x versions. For more details check this [issue-319](https://github.com/opensearch-project/job-scheduler/issues/319).                |


#### Release Workflows
See the [source code](https://github.com/opensearch-project/opensearch-build/tree/main/jenkins/release-workflows) for most of the release workflows. Others can be found in [jenkins](https://github.com/opensearch-project/opensearch-build/tree/main/jenkins) directory. All workflows are sourced from `main` branch.

| Workflow                                                                                 | Description         |
| ---------------------------------------------------------------------------------------- | ------------------- |
| [Central Promotion Workflow](https://build.ci.opensearch.org/job/central-release-promotion/) | A centralized release workflow than executes bunch of child workflows (see below) to publish various ditributions of OpenSearch and OpenSearch Dashboards for a given version. |
| [Distribution Promote Repos](https://build.ci.opensearch.org/job/distribution-promote-repos/)         | Workflow that signs and promotes the APT/YUM repos to the production buckets accessed via the cloudfront. |
| [Distribution Promote artifacts](https://build.ci.opensearch.org/job/distribution-promote-artifacts/) | Workflow that signs and promotes all the release artifacts to the production buckets accessed via the cloudfront. |
| [Publish to Maven](https://build.ci.opensearch.org/job/publish-to-maven/)                | Workflow that signs and publishes to the central maven repository.|
| [Docker Promotion](https://build.ci.opensearch.org/job/docker-promotion/)                | Workflow that promotes the docker images to production dockerHub and ECR repositories. |
| [Validation Workflow](https://build.ci.opensearch.org/job/distribution-validation)       | Workflow that validates the released distribution. |

##### Other Release-related workflows

| Workflow                                                                                 | Description         |
| ---------------------------------------------------------------------------------------- | ------------------- |
| [Release Branch Creation](https://build.ci.opensearch.org/job/release-branch-creation)   | Workflow for creating release branches if one does not exist in all the component repositories. |
| [Release Manifest Commit Lock](https://build.ci.opensearch.org/job/release-manifest-commit-lock) | Workflow for locking the manifest references to a specific or most recent commit/tag. |
| [Release Notes Tracker](https://build.ci.opensearch.org/job/release-notes-tracker/)      | Workflow that identifies if a component has a release notes added based on the commit history.  |
| [Distribution Release Tag Creation](https://build.ci.opensearch.org/job/distribution-release-tag-creation/) | Workflow responsible for creating tags for a given version in all the components' repositories. Also creates a pull request to lock the manifest to newly created tags. |


#### Creating a New Version

Each new OpenSearch release process starts when core component (OpenSearch or OpenSearch Dashboards) increments a version. For example, [OpenSearch#1192](https://github.com/opensearch-project/OpenSearch/pull/1192) incremented the version to 2.0. The [version check automation workflow](https://build.ci.opensearch.org/job/manifest-update/) will notice this change or it can be triggered manually, and make a pull request (e.g. [opensearch-build#514](https://github.com/opensearch-project/opensearch-build/pull/514)) that adds a new manifest (e.g. [opensearch-2.9.0.yml](https://github.com/opensearch-project/opensearch-build/blob/main/legacy-manifests/2.9.0/opensearch-2.9.0.yml)). After that's merged, a GitHub issue is automatically opened by [release workflow](https://github.com/opensearch-project/opensearch-build/blob/main/.github/workflows/releases.yml) to make a new release using [the release template](https://github.com/opensearch-project/opensearch-build/blob/main/.github/ISSUE_TEMPLATE/release_template.md) (e.g. [opensearch-build#566](https://github.com/opensearch-project/opensearch-build/issues/566)).

### Release Manager

The release manager of a specific OpenSearch release will be assigned through volunteer model. The request for a release manager will be posted in [OpenSearch public Slack #releases channel](https://opensearch.slack.com/archives/C0561HRK961) and selected on first come first served (FCFS) model.
Note: The release manager should be a maintainer of a repo under OpenSearch GitHub organization.

### Release Label

The release label creation is part of the version increment workflows running in the build repo [OpenSearch Version Increment Workflow](https://github.com/opensearch-project/opensearch-build/blob/main/.github/workflows/os-increment-plugin-versions.yml),
[OpenSearch Dashboards Version Increment Workflow](https://github.com/opensearch-project/opensearch-build/blob/main/.github/workflows/osd-increment-plugin-versions.yml). These workflows not only raise a pull request for a version increment but also verify if the release label exists for a given version. If it doesn't, it proceeds to create one.

### Release Issue

This issue captures the state of the OpenSearch release, its assignee is responsible for driving the release. Please contact them or @mention them on this issue for help. There are linked issues on components of the release where individual components can be tracked. More details are included in the Maintainers Release owner section.


#### Release Issue Update

The release issue is created by an [automation workflow](https://github.com/opensearch-project/opensearch-build/blob/main/.github/workflows/releases.yml). Once the release manager is finalized, the release manager should be updating the created release issue. Sample [Release Issue 2.8.0](https://github.com/opensearch-project/opensearch-build/issues/3434). Update the release issue so all `__REPLACE_RELEASE-__` placeholders have actual dates.

### Increase the Build Frequency

Increase the build frequency for the release from once a day (H 1 * * *) to once every hour (H/60 * * * *) in [check-for-build.jenkinsfile](https://github.com/opensearch-project/opensearch-build/blob/main/jenkins/check-for-build.jenkinsfile). This will ensure the [Distribution Build](#distribution-build) workflow is called every hour to build and detect the components' failure early that are part of the [Input Manifest](#input-manifest).

### Update the Maven Publish Workflow

This step is necessary solely for the `1.3.x` release process; you can find more information in the [issue](https://github.com/opensearch-project/job-scheduler/issues/319). Please make sure to update and execute the `1.x Maven Publish workflow`; you can find the workflow specifics in the [Build Workflows](#build-workflows) section. Additionally, you can refer to a relevant [sample PR](https://github.com/opensearch-project/opensearch-build/pull/3838).

## Campaigns

This section is not required for a patch release.

### Component Release Issues

The component release issues are auto created by the workflows part of the build repo [OpenSearch components](https://github.com/opensearch-project/opensearch-build/blob/main/.github/workflows/os-release-issues.yml), [OpenSearch Dashboards components](https://github.com/opensearch-project/opensearch-build/blob/main/.github/workflows/osd-release-issues.yml). These workflows create the release issues based on the template [component_release_template.md](https://github.com/opensearch-project/opensearch-build/blob/main/.github/ISSUE_TEMPLATE/component_release_template.md) and links back the global release issue part of the build. Sample [component release issue](https://github.com/opensearch-project/job-scheduler/issues/642) created for 2.16.0 release. The release manager must verify that each component release issue has an assigned owner, as this is one of the entry criteria for the release.

<details><summary>Manual release issue creation process</summary>
<p>

Inside the template [component_release_template.md](https://github.com/opensearch-project/opensearch-build/blob/main/.github/ISSUE_TEMPLATE/component_release_template.md), replace the fields `RELEASE_VERSION`, `RELEASE_BRANCH_X`, `RELEASE_BRANCH` and `RELEASE_ISSUE` to desired release values before creating the release issues across the component/plugin repos. Once the fields are replaced, use the  `meta` and `gh` cli to create the issues. Find the list of components/plugins from the [opensearch-plugins](https://github.com/opensearch-project/opensearch-plugins) repo (for [OpenSearch](https://github.com/opensearch-project/opensearch-plugins/tree/main/plugins), for [OpenSearch Dashboards](https://github.com/opensearch-project/opensearch-plugins/tree/main/dashboards-plugins)) and use the `meta` cli to create the release issues. For more details check the [create-an-issue-in-all-plugin-repos](https://github.com/opensearch-project/opensearch-plugins/blob/main/META.md#create-an-issue-in-all-plugin-repos) section.

```
meta exec "gh issue create --label v2.8.0 --title 'Release version 2.8.0' --body-file /tmp/opensearch-build/.github/ISSUE_TEMPLATE/component_release_template.md"
```

</p>
</details> 

### Release Campaigns

If any release specific issues/campaigns exists, link it back to the release issue. Sample linked [issues/campaigns](https://github.com/opensearch-project/opensearch-build/issues/3434#issuecomment-1552138916)

## Release Branch Readiness

The `Release Branch Readiness date` is determined as the release date minus 6 days. However, after receiving some feedback from the maintainers as to avoid multiple backports of the Pull Requests, it is recommended to create release branch (if one does not exist) on the day of first Release Candidate generation. The release branch creation (if one does not exist) is [automated](#other-release-related-workflows).

### Release Branch

This release branch creation is not applicable for patch release.

#### Core

This step requires both OpenSearch and OpenSearch Dashboards to create a release branch that will be used for the release. If not created already, [release-branch-creation workflow](https://build.ci.opensearch.org/view/Release/job/release-branch-creation/) will create one based of `major.x` branch. 

#### Components

This step requires that every team participating in a release has their release branch created for the corresponding release by the date listed on this step. If not created already, [release-branch-creation workflow](https://build.ci.opensearch.org/view/Release/job/release-branch-creation/) will create one based of `major.x` branch. The [Distribution Build](#distribution-build) workflow will also start using the release branch to create release candidate instead of `major.x` branches.


### Version Increment

Versions are incremented as soon as development starts on a given version to avoid confusion. Following is the example that depicts the version increment.

* OpenSearch: `main` = 3.0.0, `2.x` = 2.9.0, and `2.8` = 2.8.1
* common-utils: `main` = 3.0.0.0, `2.x` = 2.9.0.0 and `2.8` = 2.8.1.0

#### Core Version Increment

To ensure the version incrementation process is handled correctly, it is important to increment the version of the release branch. Currently, the version incrementation is being done manually by an individual from the core repositories. Sample OpenSearch Version Increment [PR](https://github.com/opensearch-project/OpenSearch/pull/7864/).


#### Components Version Increment

The next step is to identify the pending component version increment pull requests. The creation of component version increment pull requests is automated with workflows running in the build repo [OpenSearch Version Increment Workflow](https://github.com/opensearch-project/opensearch-build/blob/main/.github/workflows/os-increment-plugin-versions.yml),
[OpenSearch Dashboards Version Increment Workflow](https://github.com/opensearch-project/opensearch-build/blob/main/.github/workflows/osd-increment-plugin-versions.yml). Sample component version increment [PR](https://github.com/opensearch-project/job-scheduler/pull/398).

The objective is to merge these pull requests in order to synchronize all the components with the core version. It is not as simple as submitting a pull request and having it merged. When a pull request is submitted, CI checks are triggered for each repository. These CI checks assess the dependencies. Thus, prior to merging the pull requests that involve version increments, the release manager must confirm that the dependencies have been updated, built, and pushed to Maven and S3. This crucial stage requires the release manager to coordinate with the component teams, address any dependency issues, and ultimately merge the pull requests that involve version increments.

## Code Complete and Feature Freeze

Coordinate with the Core and component teams to ensure that the code for this particular release version is fully prepared and that the corresponding branch has been included in the release version [Input Manifest](#input-manifest). Update Jenkins workflows that execute daily snapshot builds for both OpenSearch and OpenSearch Dashboards (Ref [Increase the build frequency](#increase-the-build-frequency)). For new components on-boarding to the distribution, please submit pull requests to incorporate the component into the [Input Manifest](#input-manifest) along with the necessary checks. Sample [PR](https://github.com/opensearch-project/opensearch-build/pull/3501/files). The `Feature Freeze date` and the `Code Complete date` is determined as the release date minus 14 days.

## Release Candidate Creation and Testing

### Distribution Build

Refer the [Build Workflows](#build-workflows) section to get the details about the distribution build job for OpenSearch and OpenSearch Dashboards. This section covers how to sequentially handle the distribution build job during the release. 

#### Workflow Trigger

Ensure the proper inputs are used to initiate the distribution. For instance, here's an example for OpenSearch. It's important that the OpenSearch Dashboard distribution aligns accordingly.

![Alt Text](https://github.com/opensearch-project/opensearch-build/blob/main/assests/distribution_build_os.png)

<details><summary>Parameters info</summary>
<p>

**COMPONENT_NAME**: \<Optional\> To trigger a specific component, this includes standalone OpenSearch or specific plugin.</br>

**INPUT_MANIFEST**: \<Required\> The release input manifest that drives the workflow.</br>

**TEST_MANIFEST**: \<Optional\> The release test input manifest that is used for the integ tests.</br>

**INTEG_TEST_JOB_NAME**: \<Optional\> The integ test job name. Default already added to this input `integ-test` for OpenSearch and `integ-test-opensearch-dashboards` for OpenSearch Dashboards.</br>

**BWC_TEST_JOB_NAME**: \<Optional\> The BWC test job name. Default already added to this input `bwc-test` for OpenSearch and `bwc-test-opensearch-dashboards` for OpenSearch Dashboards.</br>

**BUILD_PLATFORM**: \<Required\> Platforms to build. Example linux, windows.</br>

**BUILD_DISTRIBUTION**: \<Required\> Distribution to build. Choices include 'tar', 'rpm', 'deb', 'zip'. Can combine multiple distributions separated by space. In order to build Docker distribution (option specified later), tar needs to be built.</br>

**TEST_PLATFORM**: \<Optional\> Platforms to tests. Choices include 'linux', 'windows'. Can combine multiple platforms with space in between. </br>

**TEST_DISTRIBUTION**: \<Optional\> Distributions to tests. Choices include 'tar', 'rpm', 'deb', 'zip'. Can combine multiple distributions with space in between. </br>

**RC_NUMBER**: \<Required\> The RC build count. Default is 0 which means its not a Release Candidate. </br>

**BUILD_DOCKER**: Input with a dropdown that has 3 options `build_docker`, `build_docker_with_build_number_tag`, `do_not_build_docker`, the release manager has to take a call with right inputs.</br>

**UPDATE_LATEST_URL**: To update the `/latest` CFN URL, Visit [latest-distribution-url](https://github.com/opensearch-project/opensearch-build/wiki/Building-an-OpenSearch-and-OpenSearch-Dashboards-Distribution#latest-distributions-buildsl) for more details.</br>

**UPDATE_GITHUB_ISSUE**: To create/close/update a github issue for all component or not.</br>

**CONTINUE_ON_ERROR**: Continues to build the distribution even if one of the non-core or non-essential plugins fails to build.</br>

**INCREMENTAL**: Builds the distribution incrementally when a previous build is provided.</br>

**PREVIOUS_BUILD_ID**: \<Required_if_incremental_is_enabled\> Previous Ditribution Build ID to download the artifacts from.</br>
</p>
</details>

In case of failure, go to the workflow run on [Jenkins](https://build.ci.opensearch.org/view/Build/). For easy debugging and visibility, click on `Open Blue Ocean` from the left panel. This should show exactly which stage failed indicated by :x . For stages marked with as `Unstable` (:warning), it indicates that some components failed to build but a distribution was built with the successfully built components. Click on any unstable stage and then click on `./build.sh ...` to see more logs. 

##### Order of Execution

Following is the order of execution of the distribution build to address the components dependencies.

Note: The execution order specified is necessary only for versions up to `1.3.x`. For `2.x` and above the snapshots Maven dependencies are published through each component repository using the GH workflow. For more details check the [META issue](https://github.com/opensearch-project/opensearch-build/issues/3185).

###### OpenSearch
```
OpenSearch 
OpenSearch + common-utils + job-scheduler 
OpenSearch + common-utils + job-scheduler + performance-analyzer 
OpenSearch + common-utils + job-scheduler + performance-analyzer + security 
OpenSearch + common-utils + job-scheduler + ml-commons + performance-analyzer + security 
All components (which are ready after completion of version increment)
```

###### OpenSearch Dashboards
```
OpenSearch Dashboards
All components (which are ready after completion of version increment)
```

### Release Candidate

Once all the version increment PRs are merged and all the components are part of the input manifest, now it is time to generate the Release Candidate (RC). Use the [Distribution Build](#distribution-build) to generate the release candidate. Use the following section as the reference to generate the RC, validate it and broadcast it for a given release. The process of `Release Candidate Generation and Testing` should commence at least 6 days prior to the release date.

#### What sets Release Candidate different than regular builds?
Well, in terms of build, nothing. However, while triggering the build please be careful to take care of the following [workflow-triggers](#workflow-trigger) along with the other parameters.

**RC_NUMBER**: Starts with `1` and keeps on incrementing as we build more RCs through out the release process. 
**BUILD_DOCKER**: Select `build_docker_with_build_number_tag`. This ensures that [check-for-build.jenkinsfile](https://github.com/opensearch-project/opensearch-build/blob/main/jenkins/check-for-build.jenkinsfile) won't re-build periodically and override the docker image, the RC docker is created with build number. Example: [opensearchstaging/opensearch:2.18.0.10454](https://hub.docker.com/layers/opensearchstaging/opensearch/2.18.0.10454/images/sha256-7755492728968e6f7afbd20014f3e13d0d765a8690e4bc80cb2403460999b0cc)
**INCREMENTAL**: Recommend to disable it for first RC and let it build from scratch. Moving forward, it can be enabled for future builds. 
**PREVIOUS_BUILD_ID**: Build number of previous Release Candidate. Applicable only when **INCREMENTAL** parameter is enabled.

Following is the generated build number after triggering the [Distribution Build](#distribution-build) workflow. The distribution build number denotes the RC, now with the example below the finalized RC’s are `OS: 7848`, `OSD: 6126`.

| OpenSearch | OpenSearch Dashboards |
|----------|----------|
| [build_7848](https://build.ci.opensearch.org/job/distribution-build-opensearch/7848/console) | [build_6126](https://build.ci.opensearch.org/job/distribution-build-opensearch-dashboards/6126/) |

<details><summary>What if?</summary>
<p>

- What if I forgot to choose `build_docker_with_build_number_tag` while building RC? </br>
  If the docker image was build regulary overriding the default `major.minor.patch` tag, you can simply copy the image to `major.minor.patch.build_id` tag using [docker-copy](https://build.ci.opensearch.org/job/docker-copy/) workflow.
  | Docker Freeze | copy |
  |----------|----------|
  | OpenSearch  | [docker-copy](https://build.ci.opensearch.org/job/docker-copy/466/console)  | 
  | OpenSearch Dashboards  | [docker-copy](https://build.ci.opensearch.org/job/docker-copy/467/console)  |

</p>
</details>

#### Docker Scan

Following are the details for the docker image build and scan. The docker images are built using the TAR artifact generated as part of the [Distribution Build](#distribution-build) (From the above example `OS: 7848`, `OSD: 6126`). The [Distribution Build](#distribution-build) workflow with input `BUILD_DOCKER` or `build_docker_with_build_number_tag` (Ref [Workflow Trigger](#workflow-trigger)) triggers the [docker-build](https://build.ci.opensearch.org/job/docker-build/) workflow as downstream which also triggers [docker-scan](https://build.ci.opensearch.org/job/docker-scan/). Docker scan is responsible for parsing the docker image for possible vulnerabilities. It uses [trivy](https://github.com/aquasecurity/trivy) to scan the docker images.

| Docker | build | scan |
|----------|----------|----------|
| OpenSearch  | [Build](https://build.ci.opensearch.org/job/docker-build/3371/)  | [Scan](https://build.ci.opensearch.org/job/docker-scan/1558/artifact/scan_docker_image.txt)   |
| OpenSearch Dashboards  | [Build](https://build.ci.opensearch.org/job/docker-build/3370/)  | [Scan](https://build.ci.opensearch.org/job/docker-scan/1557/artifact/scan_docker_image.txt)   |

#### Integration Tests

For more details on running integration tests, refer [wiki](https://github.com/opensearch-project/opensearch-build/wiki/Testing-the-Distribution#integration-tests). As one of the exit criteria, it is important to have all the integration tests passing for all the platforms. See [build-workflow](#build-workflows) for details on integration test workflow for OpenSearch and OpenSearch Dashboards. As a part of build-workflow if the parameters (TEST_MANIFEST, INTEG_TEST_JOB_NAME, TEST_PLATFORM, TEST_DISTRIBUTION) are provided during the release candidate build, integration tests will be triggered for all distributions. 

Failing integration tests create GitHub issues with all the details included in the respective repository. [Sample issue](https://github.com/opensearch-project/security-analytics/issues/1451)

<details><summary>What if?</summary>
<p>

- What if I missed one of the integration test parameter while triggering RC? </br>
  Integration test workflows can be triggered and run independently irrespective of build workflows. Feel free to trigger the respective workflow. The results of the integration tests for per component can be viewed in pipeline view as well as on the [metrics portal](https://metrics.opensearch.org/_dashboards/app/dashboards#/view/21aad140-49f6-11ef-bbdd-39a9b324a5aa?_g=(filters:!(),refreshInterval:(pause:!t,value:0),time:(from:now-90d,to:now))&_a=(description:'OpenSearch%20Release%20Build%20and%20Integration%20Test%20Results',filters:!(),fullScreenMode:!f,options:(hidePanelTitles:!f,useMargins:!t),query:(language:kuery,query:''),timeRestore:!t,title:'OpenSearch%20Release%20Build%20and%20Integration%20Test%20Results',viewMode:view)).

- What is I want to re-run the integration test? Is there a limit to how many times the workflow can be triggered? </br>
  There is no limit as such. The tests for the given component(s) can be run any number of times. However, please be mindful of the resources consumption used to run these tests. For flaky integration test, please create an issue in the respective component repository for it to be addressed.

</p>
</details>

#### Backwards Compatibility Tests

For more details in running the BWC tests refer [Backwards Compatibility Tests](https://github.com/opensearch-project/opensearch-plugins/blob/main/TESTING.md#bwc-tests-on-distribution-bundle-level) section.
On board the components/plugins to the test [Test Manifest](#test-manifest) with the `bwc-test` setting. Example as follows:
```
  - name: index-management
    bwc-test:
      test-configs:
        - with-security
```

#### Broadcast and Communication

Broadcast the release candidate in OpenSearch public slack workspace (releases channel) and the GitHub release issue using format [sample broadcast message](https://github.com/opensearch-project/opensearch-build/issues/3434#issuecomment-1571201919) to gather votes.

As a release manager, it is essential to ensure the successful completion of all the above mentioned jobs. In the event of failures during integration tests or scans, the release manager should collaborate with the component teams and initiate a re-run to ensure that all jobs are executed successfully.

Post all the job related failures in the `Release issue`, Sample [post](https://github.com/opensearch-project/opensearch-build/issues/3331#issuecomment-1550461519).

#### Release Candidate Lock

Stop builds for this version of OpenSearch and/or OpenSearch Dashboards in order to avoid accidental commits going in unknowingly. This is done by locking the commits in the [input manifest](#input-manifest). Use [release-manifest-commit-lock workflow](https://build.ci.opensearch.org/job/release-manifest-commit-lock/) with appropriate action.

#### Stop Periodic Auto Builds
Once the RC is finalized, in order to exclude the release from running periodically, at this point it is necessary for the release manager to lock the input manifest and update the `check-for-build.jenkins` to remove it from the scheduled execution, sample [PR](https://github.com/opensearch-project/opensearch-build/pull/3523/files).

#### Benchmark Tests

For running the benchmark tests, use the `benchmark-test` job part of the [Build Workflows](#build-workflows). For more details in running the benchmark tests refer [Benchmarking Tests](https://github.com/opensearch-project/opensearch-build/tree/main/src/test_workflow#benchmarking-tests) section part of the [test workflow](https://github.com/opensearch-project/opensearch-build/tree/main/src/test_workflow). This job offers multiple options to test the performance of a specific version cluster using various metrics. The benchmark performance results can be accessed via the [OpenSearch Performance Benchmarks dashboard](https://opensearch.org/benchmarks). Sample benchmark tests for [2.9.0 release](https://github.com/opensearch-project/opensearch-build/issues/3616#issuecomment-1642764515).

## Release

### Pre-Release

Ensure that all pre-release activities listed below are completed before proceeding with the final release. These activities hold great significance as they determine whether the release should progress further and, if approved, they contribute to saving a substantial amount of time during the release window.

#### Release Labeled Issues

Verify all issues labeled with this release have been resolved. Coordinate with the core/components team to close the gaps in resolving the issues labeled with this release.

#### Go or No-Go

Get the Go / No-Go votes from project management committee (PMC) before publishing the release artifacts.

#### Release Notes

Coordinate with the plugin teams and create consolidated release notes. This step is also automated using [release-notes-tracker workflow](https://build.ci.opensearch.org/job/release-notes-tracker). Select `compile` option from the action dropdown. Sample [PR](https://github.com/opensearch-project/opensearch-build/pull/5204) created by the workflow run. Please ensure to add `Release highlights` to the consolidated release notes by pushing commits to the same PR.
Release manager can check if component team(s) has created release notes or not using the same [workflow](https://build.ci.opensearch.org/job/release-notes-tracker) with action as `check`. Release manager can choose to post the result of this check as a [comment](https://github.com/opensearch-project/opensearch-build/issues/5004#issuecomment-2438740377) on the GitHub issue. 


### Main Release

Release the artifacts to production distribution channels, update the website and inform the community of the release.

#### Central Release Promotion Workflow

The [central release promotion workflow ](https://build.ci.opensearch.org/job/central-release-promotion/) as the name suggest is responsible for releasing the OpenSearch and OpenSearch Dashboards artifacts to all the platforms. It consists of multiple child workflows that are run as a separate stage. See the promotion workflow run for [2.17.0 release](https://build.ci.opensearch.org/blue/organizations/jenkins/central-release-promotion/detail/central-release-promotion/13/pipeline). _Please note that this workflow should always be run with 2PR._
See child workflows details below:

* *Promote Repos* :  Publishes DEBIAN and RPM repositories.

| Repo | OpenSearch (Sample Runs)                                                     | OpenSearch Dashboards (Sample Runs)                                           |
| ---- | ---------------------------------------------------------------------------- | ----------------------------------------------------------------------------- |
| YUM  | [yum-os](https://build.ci.opensearch.org/job/distribution-promote-repos/46/) | [yum-osd](https://build.ci.opensearch.org/job/distribution-promote-repos/48/) |
| APT  | [apt-os](https://build.ci.opensearch.org/job/distribution-promote-repos/47/)     | [apt-osd](https://build.ci.opensearch.org/job/distribution-promote-repos/49/) |


* *Promote Artifacts*: Promotes downloadable artifacts:

| Artifacts | OpenSearch (Sample Runs)                                                                                                                                                                   | OpenSearch Dashboards (Sample Runs)                                                                                                                                                           |
| --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Windows   | [os-windows-zip-x64](https://build.ci.opensearch.org/job/distribution-promote-artifacts/233/)                                                                                              | [osd-windows-zip-x64](https://build.ci.opensearch.org/job/distribution-promote-artifacts/234/)                                                                                                |
| Debian    | [os-deb-arm64](https://build.ci.opensearch.org/job/distribution-promote-artifacts/235/),  [os-deb-x64](https://build.ci.opensearch.org/job/distribution-promote-artifacts/236/)            | [osd-deb-arm64](https://build.ci.opensearch.org/job/distribution-promote-artifacts/237/),    [osd-deb-x64](https://build.ci.opensearch.org/job/distribution-promote-artifacts/238/)           |
| TAR       | [os-tar-arm64](https://build.ci.opensearch.org/job/distribution-promote-artifacts/243/),       [os-tar-x64](https://build.ci.opensearch.org/job/distribution-promote-artifacts/246/)       | [osd-tar-arm64](https://build.ci.opensearch.org/job/distribution-promote-artifacts/245/), [osd-tar-x64](https://build.ci.opensearch.org/job/distribution-promote-artifacts/244/)               |
| RPM       | [os-rpm-arm64](https://build.ci.opensearch.org/job/distribution-promote-artifacts/239/),             [os-rpm-x64](https://build.ci.opensearch.org/job/distribution-promote-artifacts/240/) | [osd-rpm-arm64](https://build.ci.opensearch.org/job/distribution-promote-artifacts/241/),         [osd-rpm-x64](https://build.ci.opensearch.org/job/distribution-promote-artifacts/242/)      |

* *Maven Promotion* : Promotes OpenSearch to maven central. Sample [run](https://build.ci.opensearch.org/job/publish-to-maven/17/console).

* *Docker Promotion* : Publishes the images to dockerHub and ECR, Sample [run](https://build.ci.opensearch.org/job/docker-promotion/32/console).

* *Distribution Validation* : Uses the validation workflow (Ref [Release Workflows](#release-workflows)) to validate the published artifacts, sample [validation workflow run](https://build.ci.opensearch.org/job/distribution-validation/3/console).

<details><summary>What if?</summary>
<p>

- What if the workflow fails? </br>
  If the workflow fails before Maven publication stage, it is safe to re-run the workflow (Please 2PR on this as well). Central promotion workflow is a combination of child workflows which can be run independently as well. See [source code](https://github.com/opensearch-project/opensearch-build/blob/main/jenkins/release-workflows/release-promotion.jenkinsfile)

</p>
</details>

#### Collaboration with the Project Management Team

While not directly under the responsibility of a Release Manager, the following sections require coordination with the Project Management Team to ensure that the tasks are successfully fulfilled.

##### Website and Documentation Changes

Coordinate with the documentation website team to ensure the changes are in place and close the gaps in promoting the website changes to prod. At this point the maintainers of the repos [documentation-website](https://github.com/opensearch-project/documentation-website) and [project-website](https://github.com/opensearch-project/project-website) will handle this task.

##### Publish blog posts

Release blog post are added in the [project-website repo](https://github.com/opensearch-project/project-website/pull/3437). [Sample Blog Post](https://opensearch.org/blog/opensearch-2.8.0-released/)

##### Advertise on Social Media

Coordinate with the project management team to ensure the social media advertisement is completed.

### Release Checklist

Please update the checklist by updating the release issue body. By following and updating the release checklist, we can ensure the success of the release without any misses.

## Post Release

Once the release is completed following are the activities that needs to be completed by the release manager:

### Release Tags

Create release tags for all OpenSearch and OpenSearch Dashboard components by running [distribution-release-tag-creation](https://build.ci.opensearch.org/job/distribution-release-tag-creation/) workflow with the right version.

### Input Manifest Update

As a post action of the above [distribution-release-tag-creation](https://build.ci.opensearch.org/job/distribution-release-tag-creation/) workflow, [release-manifest-commit-lock](https://build.ci.opensearch.org/job/release-manifest-commit-lock/) is triggered that creates an automated [Pull Request](https://github.com/opensearch-project/opensearch-build/pull/5206) to update `refs` in input manifest with tags.

<details><summary>What if?</summary>
<p>

- What if the subsequent workflow (release-manifest-commit-lock) fails and pull request is not created? </br>
  If the release tags are created but subsequent or post action workflow fails, please debug and fix the issue if possible. The [release-manifest-commit-lock](https://build.ci.opensearch.org/job/release-manifest-commit-lock/) can also be run independently with MANIFEST_LOCK_ACTION set to `UPDATE_TO_TAGS`. If the workflow is unable to create PR due to other issues, please create the pull request manually.

</p>
</details>

### OpenSearch Build Release notes

Push or create a tag in [opensearch-build](https://github.com/opensearch-project/opensearch-build) repo with the release version. This will trigger the [release workflow](https://github.com/opensearch-project/opensearch-build/blob/main/.github/workflows/publish-release.yml) that creates a release on GitHub along with release notes for opensearch-build.

### Retrospective Issue

After each release, [releases.yml](https://github.com/opensearch-project/opensearch-build/blob/main/.github/workflows/releases.yml) automatically creates a retrospective issue for feedback collection. The Release Manager organizes a review meeting when sufficient discussion points accumulate. The process concludes with documented action items and owners, as demonstrated in the 2.17.0 release [retrospective](https://github.com/opensearch-project/opensearch-build/issues/4909) and [retro board](https://github.com/orgs/opensearch-project/projects/205/views/16?filterQuery=category%3A%22v2.17.0+Retro%22+).

### Helm and Ansible Playbook release

Update and release the [Helm chart](https://github.com/opensearch-project/helm-charts) and [ansible playbook](https://github.com/opensearch-project/ansible-playbook) with the new OpenSearch and OpenSearch Dashboards version. Sample helm chart [PR](https://github.com/opensearch-project/helm-charts/pull/431/files) and ansible [PR](https://github.com/opensearch-project/ansible-playbook/pull/131).

### Upcoming Release Preparation

The release manager for the current release should ensure that a release manager is assigned for the upcoming release. This can be achieved by coordinating in a Slack channel and [@opensearch-project/engineering-effectiveness](https://github.com/orgs/opensearch-project/teams/engineering-effectiveness) team should assist in assigning the user to the upcoming [Release issue](#release-issue).

## Communication Templates

Please utilize the provided communication templates to effectively coordinate with the teams involved in the release process. These templates are designed to assist you in communicating through the GitHub release issue and the [public Slack #releases channel](https://opensearch.slack.com/archives/C0561HRK961).

### Release Announcement

```
We are starting the process of <RELEASE_VERSION> release.
Release Issue: <RELEASE_ISSUE>
Release Manager: <RELEASE_MANAGER>

Kindly review the following information provided below regarding the release dates:

Release Branch and Version Increment:  <REPLACE_RELEASE-minus-14-days>
Feature freeze: <REPLACE_RELEASE-minus-12-days>
Code Complete: <REPLACE_RELEASE-minus-10-days>
First Release Candidate creation: <REPLACE_RELEASE-minus-6-days>
Release date: <RELEASE_DATE>
```

### Release Readiness

```
The version increment pull requests are still awaiting attention. We kindly request the plugin/component owners to review them and make an effort to merge them promptly.

OpenSearch: https://github.com/pulls?q=is%3Aopen+is%3Apr+org%3Aopensearch-project+increment+<RELEASE_VERSION>+in%3Atitle+

OpenSearch Dashboards: https://github.com/pulls?q=is%3Aopen+is%3Apr+org%3Aopensearch-project+increment+<RELEASE_VERSION>.0+in%3Atitle+
```


### Release Candidate Announcement

Refer the GitHub issue comment for [Release Candidate announcement](https://github.com/opensearch-project/opensearch-build/issues/3331#issuecomment-1549876307) from past `1.3.10` release.

### Release Complete

```
OpenSearch <RELEASE_VERSION> version has been released to public :tada:!

Thanks everyone for the help to release OpenSearch and OpenSearch Dashboards <RELEASE_VERSION>.
Component repo owners please create a github release based on the tags of <RELEASE_VERSION.0>.
Presenting the retrospective <RELEASE_RETRO_ISSUE_LINK> for the release. Please feel free to provide your valuable feedback for further improvements in the upcoming release.
```
