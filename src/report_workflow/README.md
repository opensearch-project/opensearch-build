- [Generate test-report manifest for each test](#generate-test-report-manifest-for-each-test)
- [Guide on test-report manifest from CI](#guide-on-test-report-manifest-from-ci)

# Generate test-report manifest for each test
As the name specifies, the test report workflow helps to automatically generate a consolidated report of the tests run at distribution level along with commands to reproduce the error and associated failures.

### How to Use
To use this workflow, execute the following command:
```
./report.sh <test-manifest-path> --artifact-paths opensearch=<...> opensearch-dashboards=<...> --test-run-id <...> --test-type integ-test --base-path <...>
```
For example:
```
./report.sh manifests/2.9.0/opensearch-2.9.0-test.yml -p opensearch=https://ci.opensearch.org/ci/dbc/distribution-build-opensearch/2.9.0/8172/linux/x64/tar --test-run-id 5328 --test-type integ-test --base-path https://ci.opensearch.org/ci/dbc/integ-test/2.9.0/8172/linux/x64/tar
```

### Available Options
| name                            | description                                                                    |
|---------------------------------|--------------------------------------------------------------------------------|
| test-manifest-path   <required> | Specify a test manifest path.                                                  |
| -p, --artifact-paths <required> | Artifact paths of distributions used for testing.                              |
| --base-path          <required> | Base paths of testing logs.                                                    |
| --test-type          <required> | Type of tests report generates on.                                             |
| --output-path        <optional> | Specify the path location for the test-report manifest.                        |
| --test-run-id        <required> | Specify the unique execution id that matches the id of the test.               |
| --component          <optional> | Specify a specific component or components instead of the entire distribution. |
| --verbose            <optional> | Show more verbose output.                                                      |

# Guide on Test-Report Manifest from CI

The test-report manifest(`test-report.yml`) generated by the report workflow contains aggregated test results for the components.
This machine-readable manifest schema provides comprehensive test result data.
The test-report manifest is generated each time the CI test workflow runs on Jenkins and is uploaded to our S3 bucket.

The test-report manifest includes the following attributes:

| name                           | description                                                                 |
|:-------------------------------|:----------------------------------------------------------------------------|
| schema-version                 | Version of the manifest schema (e.g., '1.0').                               |
| name                           | Name of the product (e.g., OpenSearch, OpenSearch Dashboards).              |
| test-run/Command:              | Command to trigger the test.                                                |
| test-run/TestType:             | Type of test reported by this manifest (e.g., integ-test).                  |
| test-run/TestManifest:         | Location of the test manifest used.                                         |
| test-run/DistributionManifest: | URL or local path of the bundle manifest.                                   |
| test-run/TestID:               | Test ID.                                                                    |
| components/command:            | Command to trigger the test for a specific component.                       |
| components/configs/name:       | Configuration name used for testing (e.g., with-security/without-security). |
| components/configs/status:     | Status of the test run with this configuration (e.g., PASS/FAIL).           |
| components/configs/yml:        | URL or local path to the component YAML file with detailed testing logs.    |

## FAQ
### _**How to Reproduce the Testing?**_
  - Use the provided commands from this test-report manifest. Additional details on running the commands can be found [here](https://github.com/opensearch-project/opensearch-build/tree/main/src/test_workflow#testing-a-distribution).
### _**Which Bundle Distribution Were We Using for This Test Run?**_
  - Find the bundle manifest under the DistributionManifest key. It contains information about the bundle artifacts used for testing. 
### _**How Do I See the CI Logs of This Test Run?**_
  - Access our Jenkins job: 
    - For `OpenSearch`: `https://build.ci.opensearch.org/job/<__TestType__>/<__TestID__>/`. e.g. `https://build.ci.opensearch.org/job/integ-test/<__TestID__>/`
    - For `OpenSearch Dashboards`: `https://build.ci.opensearch.org/job/<__TestType__>-opensearch-dashboards/<__TestID__>/`. e.g. `https://build.ci.opensearch.org/job/integ-test-opensearch-dashboards/<__TestID__>/`
### _**Where Can I See Detailed Testing Logs or Service Logs (e.g., Local Cluster Logs, Testing Videos)?**_
  - You can find details in the component YAML file under `components/configs/yml` in this test-report manifest. The component YAML file includes local cluster logs, stdout & stderr files, specific testing logs, and Cypress videos.  
### _**Why Are Some Component Testing Results Missing or Unavailable?**_
  - This test-report manifest is generated based on component YAML files generated during the testing process. If component YAML files are missing, we won't have details for that testing component.
  - Reasons for unavailable component YAML files:
    - The testing bundle doesn't include this component, even though it's listed in our TestManifest. Check the DistributionManifest to confirm if your component is built in.
    - The test was not run for this component, even though it's included in the TestManifest. Check our Jenkins job to see if the test for your component was executed or not. The way to look into our CI is listed above. [How do I see the CI logs of this test run](#how-do-i-see-the-ci-logs-of-this-test-run)
    - The test on this component was running, but the test recorder may not have captured the results correctly to generate the component YAML. This can happen if the testing cluster is not available. Check our Jenkins job for details. The way to look into our CI is listed above. [How do I see the CI logs of this test run](#how-do-i-see-the-ci-logs-of-this-test-run)
