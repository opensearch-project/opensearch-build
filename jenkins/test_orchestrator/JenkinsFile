pipeline {
    agent any

    parameters {
        string(name: 's3_bucket'),
        string(name: 'opensearch_version'),
        string(name: 'build_id'),
        string(name: 'architecture')
    }

    stages {
        stage('Execute Tests') {
            steps {
                // To run all three test jobs in parallel, we use "parallel" step
                // https://jenkins.io/doc/pipeline/examples/#jobs-in-parallel
                parallel (
                    IntegTests: {
                        build job: 'integ-tests'
                        parameters: [
                            string(name: 's3_bucket', value: ${params.s3_bucket}),
                            string(name: 'opensearch_version', value: ${params.opensearch_version}),
                            string(name: 'build_id', value: ${params.build_id}),
                            string(name: 'architecture', value: ${params.architecture})
                        ]
                    },
                    PerfTests: {
                        build job: 'perf-tests',
                        parameters: [
                            string(name: 's3_bucket', value: ${params.s3_bucket}),
                            string(name: 'opensearch_version', value: ${params.opensearch_version}),
                            string(name: 'build_id', value: ${params.build_id}),
                            string(name: 'architecture', value: ${params.architecture})
                        ]
                    },
                    BwcTests: {
                        build job: 'bwc-tests',
                        parameters: [
                            string(name: 's3_bucket', value: ${params.s3_bucket}),
                            string(name: 'opensearch_version', value: ${params.opensearch_version}),
                            string(name: 'build_id', value: ${params.build_id}),
                            string(name: 'architecture', value: ${params.architecture})
                        ]
                    },
                    failFast: false)
            }
        }

        stage('ResultPublisher') {
            steps {
                echo "todo: Its purpose is to publish test results/logs after the test workflow is complete"
            }
            failFast false
        }

        stage('Notify') {
            steps {
                echo "todo: This step is stubbed. Its purpose is to notify different channels for successful build"
            }
            failFast false
        }
    }
}
