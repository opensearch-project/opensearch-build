pipeline {
    agent none
    stages {
        stage('build and assemble, sha exists') {
            steps {
                script {
                    buildAssembleUpload(
                        dryRun: false, // will check whether SHA exists, which is stubbed to return true
                        manifest: 'tests/jenkins/data/opensearch-1.3.0.yml',
                        platform: 'linux',
                        architecture: 'x64'
                    )
                }
            }
        }
        stage('build and assemble, sha does not exist') {
            steps {
                script {
                    buildAssembleUpload(
                        dryRun: true, // will skip checking whether SHA exists or not
                        manifest: 'tests/jenkins/data/opensearch-1.3.0.yml',
                        platform: 'linux',
                        architecture: 'x64'
                    )
                }
            }
        }
        stage('docker, no build') {
            steps {
                script {
                    buildDockerImage(
                        manifest: 'tests/jenkins/data/opensearch-1.3.0.yml',
                        dryRun: false, // will check whether .tar.gz exists, which is stubbed to false and skip
                    )
                }
            }
        }
        stage('docker, existing build') {
            steps {
                script {
                    buildDockerImage(
                        manifest: 'tests/jenkins/data/opensearch-1.3.0.yml',
                        dryRun: true, // will skip checking whether .tar.gz exists, and build the docker image
                    )
                }
            }
        }
    }
}
